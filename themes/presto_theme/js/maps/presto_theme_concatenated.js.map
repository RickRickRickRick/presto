{"version":3,"sources":["lity.js"],"names":["window","factory","define","amd","$","module","exports","require","lity","jQuery","Zepto","this","transitionEnd","element","deferred","_deferred","_transitionEndEvent","length","one","resolve","setTimeout","promise","settings","currSettings","key","value","arguments","extend","parseQueryParams","params","p","pairs","decodeURI","split","obj","i","n","appendQueryParams","url","indexOf","param","transferHash","originalUrl","newUrl","pos","substr","error","msg","append","imageHandler","target","instance","desc","opener","data","img","failed","reject","on","naturalWidth","inlineHandler","el","placeholder","hasHideClass","e","hasClass","before","remove","closest","addClass","removeClass","after","youtubeHandler","matches","_youtubeRegex","exec","iframeHandler","autoplay","vimeoHandler","_vimeoRegex","facebookvideoHandler","_facebookvideoRegex","googlemapsHandler","_googlemapsRegex","output","winHeight","document","documentElement","clientHeight","Math","round","_win","height","keydown","current","currentInstance","keyCode","close","handleTabKey","focusableElements","find","_focusableElementsSelector","focusedIndex","index","activeElement","shiftKey","get","focus","preventDefault","resize","each","_instances","registerInstance","instanceToRegister","unshift","_html","not","undefined","_dataAriaHidden","attr","_attrAriaHidden","removeInstance","instanceToRemove","show","off","grep","oldAttr","removeAttr","removeData","handlers","preferredHandler","content","handler","currentHandlers","name","currentHandler","test","Lity","options","ready","result","css","loader","always","empty","isReady","trigger","self","isClosed","_defaultOptions","template","proxy","contains","add","appendTo","is","when","Deferred","image","inline","youtube","vimeo","googlemaps","facebookvideo","iframe","_imageRegexp","createElement","transEndEventNames","WebkitTransition","MozTransition","OTransition","transition","style","version"],"mappings":"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","file":"../presto_theme_concatenated.js","sourcesContent":["/*! Lity - v2.2.2 - 2016-12-14\n* http://sorgalla.com/lity/\n* Copyright (c) 2015-2016 Jan Sorgalla; Licensed MIT */\n(function(window, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(['jquery'], function($) {\n            return factory(window, $);\n        });\n    } else if (typeof module === 'object' && typeof module.exports === 'object') {\n        module.exports = factory(window, require('jquery'));\n    } else {\n        window.lity = factory(window, window.jQuery || window.Zepto);\n    }\n}(typeof window !== \"undefined\" ? window : this, function(window, $) {\n    'use strict';\n\n    var document = window.document;\n\n    var _win = $(window);\n    var _deferred = $.Deferred;\n    var _html = $('html');\n    var _instances = [];\n\n    var _attrAriaHidden = 'aria-hidden';\n    var _dataAriaHidden = 'lity-' + _attrAriaHidden;\n\n    var _focusableElementsSelector = 'a[href],area[href],input:not([disabled]),select:not([disabled]),textarea:not([disabled]),button:not([disabled]),iframe,object,embed,[contenteditable],[tabindex]:not([tabindex^=\"-\"])';\n\n    var _defaultOptions = {\n        handler: null,\n        handlers: {\n            image: imageHandler,\n            inline: inlineHandler,\n            youtube: youtubeHandler,\n            vimeo: vimeoHandler,\n            googlemaps: googlemapsHandler,\n            facebookvideo: facebookvideoHandler,\n            iframe: iframeHandler\n        },\n        template: '<div class=\"lity\" role=\"dialog\" aria-label=\"Dialog Window (Press escape to close)\" tabindex=\"-1\"><div class=\"lity-wrap\" data-lity-close role=\"document\"><div class=\"lity-loader\" aria-hidden=\"true\">Loading...</div><div class=\"lity-container\"><div class=\"lity-content\"></div><button class=\"lity-close\" type=\"button\" aria-label=\"Close (Press escape to close)\" data-lity-close>&times;</button></div></div></div>'\n    };\n\n    var _imageRegexp = /(^data:image\\/)|(\\.(png|jpe?g|gif|svg|webp|bmp|ico|tiff?)(\\?\\S*)?$)/i;\n    var _youtubeRegex = /(youtube(-nocookie)?\\.com|youtu\\.be)\\/(watch\\?v=|v\\/|u\\/|embed\\/?)?([\\w-]{11})(.*)?/i;\n    var _vimeoRegex =  /(vimeo(pro)?.com)\\/(?:[^\\d]+)?(\\d+)\\??(.*)?$/;\n    var _googlemapsRegex = /((maps|www)\\.)?google\\.([^\\/\\?]+)\\/?((maps\\/?)?\\?)(.*)/i;\n    var _facebookvideoRegex = /(facebook\\.com)\\/([a-z0-9_-]*)\\/videos\\/([0-9]*)(.*)?$/i;\n\n    var _transitionEndEvent = (function() {\n        var el = document.createElement('div');\n\n        var transEndEventNames = {\n            WebkitTransition: 'webkitTransitionEnd',\n            MozTransition: 'transitionend',\n            OTransition: 'oTransitionEnd otransitionend',\n            transition: 'transitionend'\n        };\n\n        for (var name in transEndEventNames) {\n            if (el.style[name] !== undefined) {\n                return transEndEventNames[name];\n            }\n        }\n\n        return false;\n    })();\n\n    function transitionEnd(element) {\n        var deferred = _deferred();\n\n        if (!_transitionEndEvent || !element.length) {\n            deferred.resolve();\n        } else {\n            element.one(_transitionEndEvent, deferred.resolve);\n            setTimeout(deferred.resolve, 500);\n        }\n\n        return deferred.promise();\n    }\n\n    function settings(currSettings, key, value) {\n        if (arguments.length === 1) {\n            return $.extend({}, currSettings);\n        }\n\n        if (typeof key === 'string') {\n            if (typeof value === 'undefined') {\n                return typeof currSettings[key] === 'undefined'\n                    ? null\n                    : currSettings[key];\n            }\n\n            currSettings[key] = value;\n        } else {\n            $.extend(currSettings, key);\n        }\n\n        return this;\n    }\n\n    function parseQueryParams(params) {\n        var pairs = decodeURI(params.split('#')[0]).split('&');\n        var obj = {}, p;\n\n        for (var i = 0, n = pairs.length; i < n; i++) {\n            if (!pairs[i]) {\n                continue;\n            }\n\n            p = pairs[i].split('=');\n            obj[p[0]] = p[1];\n        }\n\n        return obj;\n    }\n\n    function appendQueryParams(url, params) {\n        return url + (url.indexOf('?') > -1 ? '&' : '?') + $.param(params);\n    }\n\n    function transferHash(originalUrl, newUrl) {\n        var pos = originalUrl.indexOf('#');\n\n        if (-1 === pos) {\n            return newUrl;\n        }\n\n        if (pos > 0) {\n            originalUrl = originalUrl.substr(pos);\n        }\n\n        return newUrl + originalUrl;\n    }\n\n    function error(msg) {\n        return $('<span class=\"lity-error\"/>').append(msg);\n    }\n\n    function imageHandler(target, instance) {\n        var desc = (instance.opener() && instance.opener().data('lity-desc')) || 'Image with no description';\n        var img = $('<img src=\"' + target + '\" alt=\"' + desc + '\"/>');\n        var deferred = _deferred();\n        var failed = function() {\n            deferred.reject(error('Failed loading image'));\n        };\n\n        img\n            .on('load', function() {\n                if (this.naturalWidth === 0) {\n                    return failed();\n                }\n\n                deferred.resolve(img);\n            })\n            .on('error', failed)\n        ;\n\n        return deferred.promise();\n    }\n\n    imageHandler.test = function(target) {\n        return _imageRegexp.test(target);\n    };\n\n    function inlineHandler(target, instance) {\n        var el, placeholder, hasHideClass;\n\n        try {\n            el = $(target);\n        } catch (e) {\n            return false;\n        }\n\n        if (!el.length) {\n            return false;\n        }\n\n        placeholder = $('<i style=\"display:none !important\"/>');\n        hasHideClass = el.hasClass('lity-hide');\n\n        instance\n            .element()\n            .one('lity:remove', function() {\n                placeholder\n                    .before(el)\n                    .remove()\n                ;\n\n                if (hasHideClass && !el.closest('.lity-content').length) {\n                    el.addClass('lity-hide');\n                }\n            })\n        ;\n\n        return el\n            .removeClass('lity-hide')\n            .after(placeholder)\n        ;\n    }\n\n    function youtubeHandler(target) {\n        var matches = _youtubeRegex.exec(target);\n\n        if (!matches) {\n            return false;\n        }\n\n        return iframeHandler(\n            transferHash(\n                target,\n                appendQueryParams(\n                    'https://www.youtube' + (matches[2] || '') + '.com/embed/' + matches[4],\n                    $.extend(\n                        {\n                            autoplay: 1\n                        },\n                        parseQueryParams(matches[5] || '')\n                    )\n                )\n            )\n        );\n    }\n\n    function vimeoHandler(target) {\n        var matches = _vimeoRegex.exec(target);\n\n        if (!matches) {\n            return false;\n        }\n\n        return iframeHandler(\n            transferHash(\n                target,\n                appendQueryParams(\n                    'https://player.vimeo.com/video/' + matches[3],\n                    $.extend(\n                        {\n                            autoplay: 1\n                        },\n                        parseQueryParams(matches[4] || '')\n                    )\n                )\n            )\n        );\n    }\n\n    function facebookvideoHandler(target) {\n        var matches = _facebookvideoRegex.exec(target);\n\n        if (!matches) {\n            return false;\n        }\n\n        if (0 !== target.indexOf('http')) {\n            target = 'https:' + target;\n        }\n\n        return iframeHandler(\n            transferHash(\n                target,\n                appendQueryParams(\n                    'https://www.facebook.com/plugins/video.php?href=' + target,\n                    $.extend(\n                        {\n                            autoplay: 1\n                        },\n                        parseQueryParams(matches[4] || '')\n                    )\n                )\n            )\n        );\n    }\n\n    function googlemapsHandler(target) {\n        var matches = _googlemapsRegex.exec(target);\n\n        if (!matches) {\n            return false;\n        }\n\n        return iframeHandler(\n            transferHash(\n                target,\n                appendQueryParams(\n                    'https://www.google.' + matches[3] + '/maps?' + matches[6],\n                    {\n                        output: matches[6].indexOf('layer=c') > 0 ? 'svembed' : 'embed'\n                    }\n                )\n            )\n        );\n    }\n\n    function iframeHandler(target) {\n        return '<div class=\"lity-iframe-container\"><iframe frameborder=\"0\" allowfullscreen src=\"' + target + '\"/></div>';\n    }\n\n    function winHeight() {\n        return document.documentElement.clientHeight\n            ? document.documentElement.clientHeight\n            : Math.round(_win.height());\n    }\n\n    function keydown(e) {\n        var current = currentInstance();\n\n        if (!current) {\n            return;\n        }\n\n        // ESC key\n        if (e.keyCode === 27) {\n            current.close();\n        }\n\n        // TAB key\n        if (e.keyCode === 9) {\n            handleTabKey(e, current);\n        }\n    }\n\n    function handleTabKey(e, instance) {\n        var focusableElements = instance.element().find(_focusableElementsSelector);\n        var focusedIndex = focusableElements.index(document.activeElement);\n\n        if (e.shiftKey && focusedIndex <= 0) {\n            focusableElements.get(focusableElements.length - 1).focus();\n            e.preventDefault();\n        } else if (!e.shiftKey && focusedIndex === focusableElements.length - 1) {\n            focusableElements.get(0).focus();\n            e.preventDefault();\n        }\n    }\n\n    function resize() {\n        $.each(_instances, function(i, instance) {\n            instance.resize();\n        });\n    }\n\n    function registerInstance(instanceToRegister) {\n        if (1 === _instances.unshift(instanceToRegister)) {\n            _html.addClass('lity-active');\n\n            _win\n                .on({\n                    resize: resize,\n                    keydown: keydown\n                })\n            ;\n        }\n\n        $('body > *').not(instanceToRegister.element())\n            .addClass('lity-hidden')\n            .each(function() {\n                var el = $(this);\n\n                if (undefined !== el.data(_dataAriaHidden)) {\n                    return;\n                }\n\n                el.data(_dataAriaHidden, el.attr(_attrAriaHidden) || null);\n            })\n            .attr(_attrAriaHidden, 'true')\n        ;\n    }\n\n    function removeInstance(instanceToRemove) {\n        var show;\n\n        instanceToRemove\n            .element()\n            .attr(_attrAriaHidden, 'true')\n        ;\n\n        if (1 === _instances.length) {\n            _html.removeClass('lity-active');\n\n            _win\n                .off({\n                    resize: resize,\n                    keydown: keydown\n                })\n            ;\n        }\n\n        _instances = $.grep(_instances, function(instance) {\n            return instanceToRemove !== instance;\n        });\n\n        if (!!_instances.length) {\n            show = _instances[0].element();\n        } else {\n            show = $('.lity-hidden');\n        }\n\n        show\n            .removeClass('lity-hidden')\n            .each(function() {\n                var el = $(this), oldAttr = el.data(_dataAriaHidden);\n\n                if (!oldAttr) {\n                    el.removeAttr(_attrAriaHidden);\n                } else {\n                    el.attr(_attrAriaHidden, oldAttr);\n                }\n\n                el.removeData(_dataAriaHidden);\n            })\n        ;\n    }\n\n    function currentInstance() {\n        if (0 === _instances.length) {\n            return null;\n        }\n\n        return _instances[0];\n    }\n\n    function factory(target, instance, handlers, preferredHandler) {\n        var handler = 'inline', content;\n\n        var currentHandlers = $.extend({}, handlers);\n\n        if (preferredHandler && currentHandlers[preferredHandler]) {\n            content = currentHandlers[preferredHandler](target, instance);\n            handler = preferredHandler;\n        } else {\n            // Run inline and iframe handlers after all other handlers\n            $.each(['inline', 'iframe'], function(i, name) {\n                delete currentHandlers[name];\n\n                currentHandlers[name] = handlers[name];\n            });\n\n            $.each(currentHandlers, function(name, currentHandler) {\n                // Handler might be \"removed\" by setting callback to null\n                if (!currentHandler) {\n                    return true;\n                }\n\n                if (\n                    currentHandler.test &&\n                    !currentHandler.test(target, instance)\n                ) {\n                    return true;\n                }\n\n                content = currentHandler(target, instance);\n\n                if (false !== content) {\n                    handler = name;\n                    return false;\n                }\n            });\n        }\n\n        return {handler: handler, content: content || ''};\n    }\n\n    function Lity(target, options, opener, activeElement) {\n        var self = this;\n        var result;\n        var isReady = false;\n        var isClosed = false;\n        var element;\n        var content;\n\n        options = $.extend(\n            {},\n            _defaultOptions,\n            options\n        );\n\n        element = $(options.template);\n\n        // -- API --\n\n        self.element = function() {\n            return element;\n        };\n\n        self.opener = function() {\n            return opener;\n        };\n\n        self.options  = $.proxy(settings, self, options);\n        self.handlers = $.proxy(settings, self, options.handlers);\n\n        self.resize = function() {\n            if (!isReady || isClosed) {\n                return;\n            }\n\n            content\n                .css('max-height', winHeight() + 'px')\n                .trigger('lity:resize', [self])\n            ;\n        };\n\n        self.close = function() {\n            if (!isReady || isClosed) {\n                return;\n            }\n\n            isClosed = true;\n\n            removeInstance(self);\n\n            var deferred = _deferred();\n\n            // We return focus only if the current focus is inside this instance\n            if (\n                activeElement &&\n                (\n                    document.activeElement === element[0] ||\n                    $.contains(element[0], document.activeElement)\n                )\n            ) {\n                try {\n                    activeElement.focus();\n                } catch (e) {\n                    // Ignore exceptions, eg. for SVG elements which can't be\n                    // focused in IE11\n                }\n            }\n\n            content.trigger('lity:close', [self]);\n\n            element\n                .removeClass('lity-opened')\n                .addClass('lity-closed')\n            ;\n\n            transitionEnd(content.add(element))\n                .always(function() {\n                    content.trigger('lity:remove', [self]);\n                    element.remove();\n                    element = undefined;\n                    deferred.resolve();\n                })\n            ;\n\n            return deferred.promise();\n        };\n\n        // -- Initialization --\n\n        result = factory(target, self, options.handlers, options.handler);\n\n        element\n            .attr(_attrAriaHidden, 'false')\n            .addClass('lity-loading lity-opened lity-' + result.handler)\n            .appendTo('body')\n            .focus()\n            .on('click', '[data-lity-close]', function(e) {\n                if ($(e.target).is('[data-lity-close]')) {\n                    self.close();\n                }\n            })\n            .trigger('lity:open', [self])\n        ;\n\n        registerInstance(self);\n\n        $.when(result.content)\n            .always(ready)\n        ;\n\n        function ready(result) {\n            content = $(result)\n                .css('max-height', winHeight() + 'px')\n            ;\n\n            element\n                .find('.lity-loader')\n                .each(function() {\n                    var loader = $(this);\n\n                    transitionEnd(loader)\n                        .always(function() {\n                            loader.remove();\n                        })\n                    ;\n                })\n            ;\n\n            element\n                .removeClass('lity-loading')\n                .find('.lity-content')\n                .empty()\n                .append(content)\n            ;\n\n            isReady = true;\n\n            content\n                .trigger('lity:ready', [self])\n            ;\n        }\n    }\n\n    function lity(target, options, opener) {\n        if (!target.preventDefault) {\n            opener = $(opener);\n        } else {\n            target.preventDefault();\n            opener = $(this);\n            target = opener.data('lity-target') || opener.attr('href') || opener.attr('src');\n        }\n\n        var instance = new Lity(\n            target,\n            $.extend(\n                {},\n                opener.data('lity-options') || opener.data('lity'),\n                options\n            ),\n            opener,\n            document.activeElement\n        );\n\n        if (!target.preventDefault) {\n            return instance;\n        }\n    }\n\n    lity.version  = '2.2.2';\n    lity.options  = $.proxy(settings, lity, _defaultOptions);\n    lity.handlers = $.proxy(settings, lity, _defaultOptions.handlers);\n    lity.current  = currentInstance;\n\n    $(document).on('click.lity', '[data-lity]', lity);\n\n    return lity;\n}));\n"]}